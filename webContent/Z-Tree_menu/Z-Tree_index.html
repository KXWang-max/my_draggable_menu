<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Z-Tree_index</title>
    <script src="/my_draggable_menu/static/js/jquery/jquery-3.4.1/jquery-3.4.1.js"></script>
    <script src="/my_draggable_menu/static/js/zTree_v3/js/jquery.ztree.all.js"></script>
    <link rel="stylesheet" href="/my_draggable_menu/static/js/zTree_v3/css/metroStyle/metroStyle.css">
    <script>
        var zTree;
        var settings = {
            treeId:"tree_menu",//唯一标识
            view:{
                showTitle:false,
                addHoverDom: addHoverDom,  //鼠标hover,显示添加节点
                removeHoverDom: removeHoverDom, //移除
            },
            data: {
                simpleData: {
                    enable: true,  //true 、 false 分别表示 使用 、 不使用 简单数据模式
                    idKey: "id",  //节点数据中保存唯一标识的属性名称
                    pIdKey: "pId",    //节点数据中保存其父节点唯一标识的属性名称
                    rootPId: 0  //用于修正根节点父节点数据，即 pIdKey 指定的属性值
                },
                key: {
                    name: "menuName"  //zTree 节点数据保存节点名称的属性名称  默认值："name"
                }
            },
            check:{
                enable:false,  //true 、 false 分别表示 显示 、不显示 复选框或单选框
                nocheckInherit:true  //当父节点设置 nocheck = true 时，设置子节点是否自动继承 nocheck = true
            },
            edit:{
                enable:true,
                showRemoveBtn:true,
                showRenameBtn:true,
                drag:{
                    isMove:true,
                    autoOpenTime:200  //拖拽时，父节点自动展开的延时间隔
                }
            },
            // callback:{
            //     beforeRemove:beforeRemove,//点击删除时触发，用来提示用户是否确定删除（可以根据返回值 true|false 确定是否可以删除）
            //     beforeEditName: beforeEditName,//点击编辑时触发，用来判断该节点是否能编辑
            //     beforeRename:beforeRename,//编辑结束时触发，用来验证输入的数据是否符合要求(也是根据返回值 true|false 确定是否可以编辑完成)
            //     onRemove:onRemove,//(beforeRemove返回true之后可以进行onRemove)删除节点后触发，用户后台操作
            //     onRename:onRename,//编辑后触发，用于操作后台
            //     beforeDrag:beforeDrag,//用户禁止拖动节点
            //     onClick:clickNode//点击节点触发的事件
            // }
        };
        //层级结构数据
        // var zNodes = [
        //     //注意，数据中的 menuName 必须与 settingss 中key 中定义的name一致，否则找不到
        //     {menuName:"父节点1", open:true, children:[
        //             {menuName:"子节点1"}, {menuName:"子节点2"}]},
        //     {menuName:"父节点2", open:true, children:[
        //             {menuName:"子节点3"}, {menuName:"子节点4"}]}
        // ];
        //平行结构数据
        var zNodes =[
            { id:1, pId:0,  menuName:"总公司", open:true},

                { id:11, pId:1, menuName:"合资公司 1"},
                    { id:111, pId:11, menuName:"有限公司 1-1"},
                         { id:1111, pId:111, menuName:"区域1"},
                             { id:11111, pId:1111, menuName:"站点1-1"},
                             { id:11112, pId:1111, menuName:"站点1-2"},
                         { id:1112, pId:111, menuName:"区域2"},
                         { id:1113, pId:111, menuName:"区域3"},
                    { id:112, pId:11, menuName:"有限公司 1-2"},
                    { id:113, pId:11, menuName:"有限公司 1-3"},

                { id:12, pId:1, menuName:"合资公司 2"},
                    { id:121, pId:12, menuName:"有限公司 2-1"},
                    { id:122, pId:12, menuName:"有限公司 2-2"},
                    { id:123, pId:12, menuName:"有限公司 2-3"},
        ];
        //鼠标移入显示添加节点
        var newCount = 1;
        function addHoverDom(treeId, treeNode) {
            var sObj = $("#" + treeNode.tId + "_span"); //获取节点信息
            if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
            var addStr = "<span class='button add' id='addBtn_" + treeNode.tId + "' title='add node' οnfοcus='this.blur();'></span>"; //定义添加按钮
            sObj.after(addStr); //加载添加按钮
            var btn = $("#addBtn_"+treeNode.tId);
            //绑定添加事件，并定义添加操作
            if (btn) btn.bind("click", function(){
                var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                //add item
                zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
                return false;
                //将新节点添加到数据库中
                // var menuName='NewNode';
                // $.post('./index.php?r=data/addtree&pid='+treeNode.id+'&menuName='+menuName,function (data) {
                //     var newID = data; //获取新添加的节点Id
                //     zTree.addNodes(treeNode, {id:newID, pId:treeNode.id, menuName:menuName}); //页面上添加节点
                //     var node = zTree.getNodeByParam("id", newID, null); //根据新的id找到新添加的节点
                //     zTree.selectNode(node); //让新添加的节点处于选中状态
                // });
            });
        };
        //鼠标移除隐藏添加按钮
        function removeHoverDom(treeId, treeNode) {
            $("#addBtn_"+treeNode.tId).unbind().remove();
        };


        $(function (){
            zTreeObj = $.fn.zTree.init($("#treeDemo"), settings, zNodes); //初始化树
            zTreeObj.expandAll(true);    //true 节点全部展开、false节点全部收缩
        })
    </script>
</head>
<body>
    <div>
        <ul id="treeDemo" class="ztree"></ul>
    </div>
</body>
</html>