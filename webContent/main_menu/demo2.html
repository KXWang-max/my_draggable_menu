<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title></title>
    <meta name="keywords" content="jQuery菜单,树状菜单,可拖拽菜单,自由排序菜单,导航菜单,jQuery插件"/>
    <meta name="description" content="一款jQuery可自由拖拽排序多级树状菜单网页特效下载，该JS特效代码是一款支持自由拖动列表排序的jquery-sortable-lists.min.js插件，可应用于网站后台管理系统、办公OA系统、CMS菜单管理等。"/>
    <link rel="stylesheet" type="text/css" href="demo2-css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="demo2-css/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="jquery-ui.css" >


    <script src="demo2-js/jquery-git1.min.js"></script>
    <script src="demo2-js/jquery-sortable-lists.min.js"></script>
<!--    <script src="jquery.js"></script>-->
    <script src="jquery-ui.min.js"></script>
    <script src="Sortable.min.js"></script>

    <script type="text/javascript">
        //添加结点函数 begin
        function add(item){
            var
        };
        //添加结点函数 end

        // 此函数功能是新建一个input元素替换p
        //当input元素失去焦点时又变回原来的p
        toReplace = function(pElement) {
            var parent = document.getElementById("item_b");
            // 创建一个input元素
            var inputElement = document.createElement("input");
            // 把obj里面的元素以及文本内容赋值给新建的inputElement
            inputElement.value = pElement.innerHTML;

            // 用新建的inputElement代替原来的oldDivElement元素
            // document.body.replaceChild(inputElement, pElement);
            parent.replaceChild(inputElement, pElement);

            // 当inputElement失去焦点时触发下面函数，使得input变成p
            inputElement.onblur = function() {
                //把input的值交给原来的p
                pElement.innerHTML = inputElement.value;
                //用原来的p重新替换inputElement
                parent.replaceChild(pElement, inputElement);
            }
        }
        window.onload = function() {
            //规定拖拽容器边界
            $('.keBody').sortable({containment:"tbody"});
            //规定拖拽时鼠标样式
            // $('.keBody').sortable({cursor:"move"});
            //设置元素被拖到边缘时，自动滚动
            $('.keBody').sortable({ scroll: true });

            //移除拖拽
            // $('#item_b').sortable('disable');

            // 加载的时候就被初始化，此处的this是指id为oldDiv的p
            // $("#all_company").ondblclick = function() {
            //     toReplace(this);
            // };

            // 改造jq-ui的sortable begin
            // $.widget("my.sortable", $.extend({}, $.ui.sortable.prototype, {
            //     _rearrange: function (event, i, a, hardRefresh) {
            //
            //         var unmovable= ".unmove", sortable = ":not(.unmove)";
            //         var fixed = $(i.item[0]).parent().find(unmovable);
            //         var orginalPos = fixed.map(function () {
            //             return $(this).index();
            //         });
            //
            //         $.ui.sortable.prototype._rearrange.apply(this, arguments);
            //
            //         fixed.each(function (n) {
            //             var el = $(this), index = orginalPos[n];
            //             if (el.index() < index) {
            //                 el.before(el.nextAll(sortable + ':first'));
            //             }
            //             else if (el.index() > index) {
            //                 $(el.nextUntil(sortable).last()[0] || el).after(el.prev());
            //             }
            //         });
            //     }
            // }));
            // 改造jq-ui的sortable end
            // $(function () {
            //     $(".unmove_ul").sortable({items:':not(.unmove)'});
            // });
            //设置sortable属性 begin
        $(function()
        {
            var options = {
                    placeholderCss: {'background-color': '#ccc'},
                    hintCss: {'background-color':'#bbf'},
                    isAllowed: function(cEl, hint, target)
                    {
                        if(hint.parents('li').first().data('module') === 'c' && cEl.data('module') !== 'c')
                        {
                            hint.css('background-color', '#ff9999');
                            return false;
                        }
                        else
                        {
                            hint.css('background-color', '#99ff99');
                            return true;
                        }
                    },
                    opener: {
                        active: true,
                        // 设置open/close的方式 begin
                        // as:'class',
                        // close: 'close',
                        // open: 'open',
                        // 设置open/close的方式 end

                        close: 'demo2-images/Remove2.png',
                        open: 'demo2-images/Add2.png',
                        openerCss: {
                            'display': 'inline-block',
                            'width': '18px',
                            'height': '18px',
                            'float': 'left',
                            'margin-left': '-35px',
                            'margin-right': '5px',
                            'background-position': 'center center',
                            'background-repeat': 'no-repeat'
                        },
                        openerClass: ''
                    }
                };
                //设置sortable属性 end
                // sWrapper = $('#settingsWrapper');

            $('#sTree2').sortableLists(options);

            $('#toArrBtn').on('click', function(){ console.log($('#sTree2').sortableListsToArray()); });
            $('#toHierBtn').on('click', function() { console.log($('#sTree2').sortableListsToHierarchy()); });
            $('#toStrBtn').on('click', function() { console.log($('#sTree2').sortableListsToString()); });
            $('.descPicture').on('click', function(e) { $(this).toggleClass('descPictureClose'); });
        });

        };
    </script>
</head>
<body class="keBody">
<h1 class="keTitle">自由拖拽排序多级树状菜单</h1>
<div class="kePublic" >
    <!--效果html开始-->
    <div class="container" style="width: auto;">
        <section id="main_content">
            <ul class="sTree2 listsClass unmove_ul" id="sTree2">
<!--                <li id="item_a" data-module="a">-->
<!--                    <div>选项 a</div>-->
<!--                </li>-->
                <li class="sortableListsOpen" id="item_b" data-module="b" style="display: flex;">
                    <div id="all_company close" style="padding-left: 50px" ondblclick="toReplace(this);">总公司</div>
                    <ul class="unmove_ul">
                        <li id="item_b1" data-module="b" style="display: flex;">
                            <div style="padding-left: 50px;text-align: right;">合资公司1</div>
                            <ul>
                                <li id="item_b1" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;text-align: right;">有限公司1</div>
                                    <ul>
                                        <li id="item_b12" data-module="b" style="display: flex;">
                                            <div style="padding-left: 50px;">1-区域1</div>
                                            <ul>
                                                <li id="item_b121" data-module="b">
                                                    <div style="padding-left: 50px;">1-站点1</div>
                                                </li>
                                                <li id="item_b122" data-module="b">
                                                    <div style="padding-left: 50px;">1-站点2</div>
                                                </li>
                                                <li id="item_b123" data-module="b">
                                                    <div style="padding-left: 50px;">1-站点3</div>
                                                </li>
                                                <li id="item_b124" data-module="b">
                                                    <div style="padding-left: 50px;">1-站点4</div>
                                                </li>
                                                <li id="add" class="add_new" onclick="add(this);">
                                                    <div style="padding-left: 50px;">+添加+</div>
                                                </li>
                                            </ul>
                                        </li>
                                        <li id="item_b12" data-module="b" style="display: flex;">
                                            <div style="padding-left: 50px;">1-区域2</div>
                                        </li>
                                        <li id="item_b12" data-module="b" style="display: flex;">
                                            <div style="padding-left: 50px;">1-区域3</div>
                                        </li>
                                        <li id="item_b12" data-module="b" style="display: flex;">
                                            <div style="padding-left: 50px;">1-区域4</div>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li id="item_b2" data-module="b" style="display: flex;">
                            <div style="padding-left: 50px;text-align: right;">合资公司2</div>
                            <ul>
                                <li id="item_b1" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;text-align: right;">有限公司2</div>
                                    <ul>
                                <li id="item_b3" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;">2-区域1</div>
                                </li>
                                <li id="item_b3" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;">2-区域2</div>
                                </li>
                                <li id="item_b3" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;">2-区域3</div>
                                </li>
                                <li id="item_b3" data-module="b" style="display: flex;">
                                    <div style="padding-left: 50px;">2-区域4</div>
                                </li>
                            </ul>
                                </li>
                            </ul>
                        </li>
                        <li id="item_b3" data-module="b" style="display: flex;">
                            <div style="padding-left: 50px;">合资公司3</div>
                        </li>
                    </ul>
                </li>
            </ul>
        </section>
    </div>
    <!--效果html结束-->
    <div class="clear"></div>
</div>
<p id="someDiv" ondblclick="toReplace(this)">双击文字实现可编辑状态</p>
</body>
</html>